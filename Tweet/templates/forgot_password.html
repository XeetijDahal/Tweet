{% extends 'layout.html' %}
{% load static %}
{% block content %}

<div class="container mt-5" style="max-width: 450px;">
  <div class="card shadow">
    <div class="card-body">
      <h3 class="text-center">Forgot Password</h3>
      <hr>

      <!-- Step 1: Email -->
      {% if not otp_sent and not otp_verified %}
      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="step" value="email">
        <div class="mb-3">
          <label>Email</label>
          <input type="email" name="email" class="form-control" required>
        </div>
        <button class="btn btn-primary w-100">Send OTP</button>
      </form>
      {% endif %}

      <!-- Step 2: Enter OTP -->
      {% if otp_sent and not otp_verified %}
      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="step" value="otp">
        <div class="mb-3">
          <label>Enter OTP sent to your email</label>
          <input type="text" name="otp" class="form-control" required>
        </div>
        <button class="btn btn-success w-100">Verify OTP</button>
      </form>
      {% endif %}

      <!-- Step 3: Set New Password -->
      {% if otp_verified %}
      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="step" value="new_password">
        <div class="mb-3">
          <label>New Password</label>
          <input type="password" name="new_password" class="form-control" required>
        </div>
        <div class="mb-3">
          <label>Confirm Password</label>
          <input type="password" name="confirm_password" class="form-control" required>
        </div>
        <button class="btn btn-dark w-100">Set New Password</button>
      </form>
      {% endif %}

      {% if messages %}
        <div class="mt-3">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}
